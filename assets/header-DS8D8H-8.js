(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const u={TMDB_API_KEY:"532c164e7aaa985e6a97f7fc762d2aea",TMDB_BASE_URL:"https://api.themoviedb.org/3",TMDB_IMAGE_BASE_URL:"https://image.tmdb.org/t/p"};console.log("YENİ MODAL.JS YÜKLENDİ - "+new Date().toLocaleTimeString());let p,v,m;function T(){return new Promise(o=>{const t=()=>{p=document.getElementById("movie-modal"),v=document.getElementById("modal-close-btn"),m=document.getElementById("modal-library-btn"),p&&v&&m?(A(),o()):requestAnimationFrame(t)};t()})}function A(){v.addEventListener("click",I),p.addEventListener("click",o=>{o.target.classList.contains("modal-backdrop")&&I()})}function I(){p.classList.remove("show"),document.body.style.overflow="";const o=document.getElementById("modal-trailer-wrapper"),t=document.getElementById("modal-trailer-iframe");o&&(o.style.display="none"),t&&(t.src="")}async function S(o){console.log("openMovieModal çağrıldı, ID:",o),await T();try{const[t,e]=await Promise.all([axios.get(`${u.TMDB_BASE_URL}/movie/${o}?api_key=${u.TMDB_API_KEY}`),axios.get(`${u.TMDB_BASE_URL}/movie/${o}/videos?api_key=${u.TMDB_API_KEY}`)]),r=t.data,n=e.data.results.find(a=>a.site==="YouTube"&&a.type==="Trailer");document.getElementById("modal-poster").src=r.poster_path?`https://image.tmdb.org/t/p/w500${r.poster_path}`:"./img/no-poster.jpg",document.getElementById("modal-title").textContent=r.title,document.getElementById("modal-vote").textContent=r.vote_average.toFixed(1),document.getElementById("modal-votes").textContent=r.vote_count,document.getElementById("modal-popularity").textContent=Math.round(r.popularity);const i=document.getElementById("modal-genre");if(r.genres&&r.genres.length>0){const a=r.genres.map(c=>c.name),y=window.innerWidth<768?2:3;if(a.length<=y)i.textContent=a.join(", ");else{const c=a.slice(0,y).join(", "),f=a.length-y;i.textContent=`${c} +${f}`,i.title=a.join(", ")}}else i.textContent="—";document.getElementById("modal-overview").textContent=r.overview||"Açıklama yok.";const s=document.getElementById("modal-trailer-wrapper"),l=document.getElementById("modal-trailer-iframe");n&&s&&l?(s.style.display="block",l.src=`https://www.youtube.com/embed/${n.key}?autoplay=1&rel=0`):s&&(s.style.display="none"),m.textContent="Add to my library",m.disabled=!1,m.onclick=()=>$(r),p.classList.add("show"),document.body.style.overflow="hidden"}catch(t){console.error("Modal hatası:",t),alert("Movie details could not be loaded!")}}function $(o){const t=JSON.parse(localStorage.getItem("myMovieLibrary")||"[]");if(t.some(e=>e.id===o.id)){alert("This movie is already in your library!");return}t.push(o),localStorage.setItem("myMovieLibrary",JSON.stringify(t)),alert(`${o.title} added to your library.`),m.textContent="Added",m.disabled=!0}const b=u.TMDB_API_KEY,w=u.TMDB_BASE_URL;function x(o){const t=o/2,e=Math.floor(t),r=t-e>=.5,n=5-e-(r?1:0);let i="";for(let s=0;s<e;s++)i+='<li><svg class="star-svg"><use href="./img/sprite.svg#full-star"></use></svg></li>';r&&(i+='<li><svg class="star-svg"><use href="./img/sprite.svg#half-star"></use></svg></li>');for(let s=0;s<n;s++)i+='<li><svg class="star-svg"><use href="./img/sprite.svg#empty-star"></use></svg></li>';return i}async function D(){try{const o=localStorage.getItem("myMovieLibrary");if(!o)return null;const t=JSON.parse(o);if(!Array.isArray(t)||t.length===0)return null;const e=t[Math.floor(Math.random()*t.length)],r=typeof e=="number"?e:e.id;if(!r)return null;const n=await fetch(`${w}/movie/${r}?api_key=${b}&append_to_response=videos`);return n.ok?await n.json():null}catch(o){return console.error("Kütüphaneden film çekilemedi:",o),null}}function C(o,t=20){const e=o.trim().split(/\s+/);return e.length<=t?o:e.slice(0,t).join(" ")+"..."}async function O(){var n,i;const o=document.getElementById("hero-default"),t=document.getElementById("hero-random-movie");if(!t||t.dataset.heroLoaded==="true")return;let e=null,r=null;try{if(document.querySelector('[data-hero-mode="library"]')&&(e=await D(),e||console.log("Kütüphane boş veya hata → trending film kullanılıyor")),!e){const d=await fetch(`${w}/trending/movie/week?api_key=${b}`);if(!d.ok)throw new Error("API Hatası");const h=await d.json();e=h.results[Math.floor(Math.random()*h.results.length)]}(n=e.videos)!=null&&n.results?r=e.videos.results.find(d=>d.site==="YouTube"&&["Trailer","Teaser","Clip"].includes(d.type)):r=(i=(await(await fetch(`${w}/movie/${e.id}/videos?api_key=${b}`)).json()).results)==null?void 0:i.find(B=>B.site==="YouTube"&&["Trailer","Teaser","Clip"].includes(B.type)),o.style.display="none",t.style.display="flex",t.querySelector(".hero-movie-title").textContent=e.title;const l=t.querySelector(".hero-movie-details"),a=e.overview||"Açıklama yok.";l.textContent=C(a,20),a.split(/\s+/).length>20&&(l.title=a),t.querySelector(".hero-movie-stars").innerHTML=`
      <ul class="card-rating hero-rating">${x(e.vote_average)}</ul>
    `;const L=t.querySelector(".hero-movie-poster-crop"),y=e.backdrop_path?`https://image.tmdb.org/t/p/original${e.backdrop_path}`:e.poster_path?`https://image.tmdb.org/t/p/w1280${e.poster_path}`:"./img/no-poster.jpg";L.style.backgroundImage=`url(${y})`;const c=document.getElementById("trailer-modal"),f=document.getElementById("watch-trailer-btn"),M=c.querySelector(".trailer-content"),k=()=>{r&&(M.innerHTML=`
          <button class="trailer-close-btn" type="button">
            <svg><use href="./img/sprite.svg#close-mobile"></use></svg>
          </button>
          <iframe src="https://www.youtube.com/embed/${r.key}?autoplay=1&rel=0" 
                  allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
        `),c.style.display="block"},g=()=>{c.style.display="none",M.innerHTML=`
        <button class="trailer-close-btn" type="button">
          <svg><use href="./img/sprite.svg#close-mobile"></use></svg>
        </button>
        <p class="trailer-info">OOPS...<br>We are very sorry!<br>But we couldn’t find the trailer.</p>
        <img src="./img/Trailer-Error-Mobile.png" srcset="./img/Trailer-Error-Desktop@2x.png 2x" alt="Trailer not found" class="trailer-image">
      `};f.onclick=k,c.querySelector(".trailer-close-btn").onclick=g,c.onclick=d=>d.target===c&&g(),document.addEventListener("keydown",d=>d.key==="Escape"&&c.style.display==="block"&&g()),document.getElementById("more-details-btn").onclick=async()=>{await S(e.id)},t.dataset.heroLoaded="true"}catch(s){console.error("Hero yüklenemedi:",s),o.style.display="block",t.style.display="none"}}function E(){const o=document.getElementById("hero-random-movie"),t=document.getElementById("hero-default");!o||!t||o.dataset.heroLoaded!=="true"&&O().then(()=>{o.dataset.heroLoaded="true"})}const _=new MutationObserver(o=>{o.forEach(t=>{t.addedNodes.forEach(e=>{var r;e.nodeType===1&&(e.id==="hero-random-movie"||(r=e.querySelector)!=null&&r.call(e,"#hero-random-movie"))&&E()})})});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{_.observe(document.body,{childList:!0,subtree:!0}),E()}):(_.observe(document.body,{childList:!0,subtree:!0}),E());window.setActiveNavLink=function(){setTimeout(()=>{const o=location.pathname.split("/").pop()||"index.html";document.querySelectorAll("a[href]").forEach(e=>{let r=e.getAttribute("href")||"";if(r=r.replace(/^\.?\//,""),r===o||(o==="index.html"||o===""||o==="home.html")&&(r==="home.html"||r==="index.html")){e.classList.add("active");const l=e.closest("li");l&&l.classList.add("active")}else{e.classList.remove("active");const l=e.closest("li");l&&l.classList.remove("active")}})},100)};document.addEventListener("DOMContentLoaded",window.setActiveNavLink);document.addEventListener("load:partial",window.setActiveNavLink);document.addEventListener("DOMContentLoaded",()=>{const o=setInterval(()=>{document.querySelector(".header-nav-link")&&(window.setActiveNavLink(),clearInterval(o))},200)});export{u as c,S as o};
//# sourceMappingURL=header-DS8D8H-8.js.map
