{"version":3,"file":"myLibrary-CWizV3Qq.js","sources":["../../src/myLibrary.js"],"sourcesContent":["import { openMovieModal } from './js/modal.js';\n\nconst genreMap = {};\nconst API_KEY = 'aaf24ac7ab7c5211361a71263e777bb9';\nlet selectedGenre = null; // SeÃ§ilen tÃ¼r ID'si (Number veya null)\n\n// LOAD MORE  SAYFALAMA DEÄžÄ°ÅžKENLERÄ°\nconst MOVIES_PER_PAGE = 20; // Bir sayfada gÃ¶sterilecek maksimum film sayÄ±sÄ±\nlet currentLibraryPage = 1; // BaÅŸlangÄ±Ã§ sayfasÄ±\nlet allFilteredMovies = []; // Filtreleme sonrasÄ± tÃ¼m filmlerin geÃ§ici olarak tutulduÄŸu dizi\n\n// DOM Elementleri\nconst selectBox = document.querySelector('.library-dropdown-filter');\nconst selected = selectBox.querySelector('.selected');\nconst optionsContainer = selectBox.querySelector('.options');\nconst listEl = document.querySelector('.library-movie-items'); // Film listesi container'Ä±\nconst loadMoreBtn = document.querySelector('.library-load-button'); // Load More butonu\n\n// Dropdown aÃ§/kapa\nselected.addEventListener('click', () => {\n  const isOpen = selectBox.classList.toggle('open');\n  optionsContainer.style.display = isOpen ? 'block' : 'none';\n});\n\n// Sayfa dÄ±ÅŸÄ±na tÄ±klayÄ±nca dropdown kapanÄ±r\ndocument.addEventListener('click', e => {\n  if (!selectBox.contains(e.target)) {\n    selectBox.classList.remove('open');\n    optionsContainer.style.display = 'none';\n  }\n});\n\n// TMDB apisinden genre Ã§ekme ve mapleme(genreMap)\nasync function loadGenres() {\n  const cachedGenresJson = localStorage.getItem('tmdbGenresIdToName');\n\n  if (cachedGenresJson) {\n    Object.assign(genreMap, JSON.parse(cachedGenresJson));\n    return;\n  }\n\n  try {\n    const response = await axios.get(\n      `https://api.themoviedb.org/3/genre/movie/list`,\n      {\n        params: { api_key: API_KEY, language: 'en-US' },\n      }\n    );\n\n    const newGenreMap = {};\n    response.data.genres.forEach(g => {\n      newGenreMap[g.id] = g.name;\n    });\n\n    Object.assign(genreMap, newGenreMap);\n    localStorage.setItem('tmdbGenresIdToName', JSON.stringify(newGenreMap));\n  } catch (err) {\n    console.error('TÃ¼rler yÃ¼klenemedi:', err);\n  }\n}\n\n// KÃ¼tÃ¼phanedeki filmlerden benzersiz tÃ¼r ID'lerini toplar ve Dinamik dropdown oluÅŸturur\nfunction getGenresFromLibrary() {\n  // ... (Mevcut getGenresFromLibrary iÃ§eriÄŸi) ...\n  const libraryJson = localStorage.getItem('myMovieLibrary');\n  if (!libraryJson) return [];\n  const libraryMovies = JSON.parse(libraryJson);\n  const uniqueGenreIds = new Set();\n  libraryMovies.forEach(movie => {\n    let genreIds = [];\n\n    if (Array.isArray(movie.genre_ids)) {\n      genreIds = movie.genre_ids;\n    } else if (Array.isArray(movie.genres)) {\n      genreIds = movie.genres.map(g => g.id);\n    }\n\n    genreIds.forEach(id => {\n      if (genreMap[id]) {\n        uniqueGenreIds.add(id);\n      }\n    });\n  });\n\n  return Array.from(uniqueGenreIds);\n}\n\n// KÃ¼tÃ¼phane tÃ¼rlerini kullanarak dropdown'Ä± oluÅŸturur\nfunction renderLibraryGenreDropdown() {\n  // ... (Mevcut renderLibraryGenreDropdown iÃ§eriÄŸi) ...\n  const requiredGenreIds = getGenresFromLibrary();\n\n  optionsContainer.innerHTML = '';\n  const defaultOption = document.createElement('div');\n  defaultOption.classList.add('option', 'selected');\n  defaultOption.textContent = 'All Film';\n  defaultOption.dataset.value = '';\n  optionsContainer.appendChild(defaultOption);\n\n  requiredGenreIds.forEach(id => {\n    const genreName = genreMap[id];\n\n    if (genreName) {\n      const option = document.createElement('div');\n      option.classList.add('option');\n      option.textContent = genreName;\n      option.dataset.value = id;\n      optionsContainer.appendChild(option);\n    }\n  });\n  updateDropdownListeners();\n}\n\n// Yeni butonlara olay dinleyicisi ekler - Filtre deÄŸiÅŸtiÄŸinde loadLibrary'i Ã§aÄŸÄ±rÄ±r\nfunction updateDropdownListeners() {\n  const optionsList = document.querySelectorAll(\n    '.library-dropdown-filter .option'\n  );\n\n  optionsList.forEach(option => {\n    option.addEventListener('click', () => {\n      selected.childNodes[0].textContent = option.textContent;\n      optionsList.forEach(o => o.classList.remove('selected'));\n      option.classList.add('selected');\n      selectBox.classList.remove('open');\n      optionsContainer.style.display = 'none';\n\n      const genreId = option.dataset.value\n        ? Number(option.dataset.value)\n        : null;\n      selectedGenre = genreId;\n\n      // Filtre deÄŸiÅŸtiÄŸinde 1. sayfadan baÅŸlamalÄ± ve listeyi TEMÄ°ZLEMELÄ°YÄ°Z.\n      currentLibraryPage = 1;\n      loadLibrary(true); // true = reset the list\n    });\n  });\n}\n\n// myLibrary'i localden Ã§ekme\ndocument.addEventListener('DOMContentLoaded', async () => {\n  await loadGenres();\n  renderLibraryGenreDropdown();\n  loadLibrary(true); // BaÅŸlangÄ±Ã§ta listeyi temizleyerek yÃ¼kle\n});\n\n// ðŸŒŸ GÃœNCELLENMÄ°Åž loadLibrary FONKSÄ°YONU ðŸŒŸ\n// resetList = true ise listeyi temizler ve filtrelemeyi baÅŸtan yapar.\nfunction loadLibrary(resetList = false) {\n  let library = JSON.parse(localStorage.getItem('myMovieLibrary')) || [];\n\n  if (library.length === 0) {\n    document.querySelector('.library-content').style.display = 'none';\n    document.querySelector('.library-content-empty').style.display = 'block';\n    loadMoreBtn.style.display = 'none'; // Film yoksa butonu gizle\n    return;\n  }\n\n  // EÄŸer resetList true ise (yani filtre deÄŸiÅŸtiyse veya ilk yÃ¼kleme ise)\n  if (resetList) {\n    currentLibraryPage = 1;\n    // 1. SeÃ§ilen tÃ¼re gÃ¶re filtrele ve sonucu global deÄŸiÅŸkene kaydet\n    let filteredLibrary = library;\n    if (selectedGenre) {\n      filteredLibrary = library.filter(movie => {\n        let movieGenreIds = [];\n        if (Array.isArray(movie.genre_ids)) {\n          movieGenreIds = movie.genre_ids;\n        } else if (Array.isArray(movie.genres)) {\n          movieGenreIds = movie.genres.map(g => g.id);\n        }\n        return movieGenreIds.includes(selectedGenre);\n      });\n    }\n    allFilteredMovies = filteredLibrary; // FiltrelenmiÅŸ listeyi kaydet\n    listEl.innerHTML = ''; // Listeyi temizle\n    loadMoreBtn.style.display = 'none';\n  }\n\n  // 2. Sayfalama dilimlerini belirle (slice)\n  const startIndex = (currentLibraryPage - 1) * MOVIES_PER_PAGE;\n  const endIndex = startIndex + MOVIES_PER_PAGE;\n\n  // Sadece mevcut sayfadaki filmleri al\n  const moviesToRender = allFilteredMovies.slice(startIndex, endIndex);\n\n  if (moviesToRender.length === 0 && resetList) {\n    listEl.innerHTML =\n      \"<p class='no-results'>SeÃ§ilen tÃ¼re ait film bulunmamaktadÄ±r.</p>\";\n    loadMoreBtn.style.display = 'none';\n    return;\n  }\n\n  // 3. Filmleri renderla (listeye ekle)\n  moviesToRender.forEach(movie => {\n    const title = movie.title || 'Unknown';\n    const poster = movie.poster_path\n      ? `https://image.tmdb.org/t/p/w300${movie.poster_path}`\n      : './img/placeholder.jpg';\n    const rating = movie.vote_average ?? 'N/A';\n    const year = movie.release_date ? movie.release_date.slice(0, 4) : 'N/A';\n\n    let movieGenreIds = [];\n    if (Array.isArray(movie.genre_ids)) {\n      movieGenreIds = movie.genre_ids;\n    } else if (Array.isArray(movie.genres)) {\n      movieGenreIds = movie.genres.map(g => g.id);\n    }\n\n    const genres = movieGenreIds\n      .map(id => genreMap[id])\n      .filter(Boolean)\n      .join(', ');\n\n    const li = document.createElement('li');\n    li.classList.add('library-movie-item');\n    li.dataset.movieId = movie.id;\n    li.style.cursor = 'pointer';\n\n    li.innerHTML = `\n        <section class=\"card\">\n            <img\n                class=\"card-image\"\n                src=\"${poster}\"\n                alt=\"${title}\"\n                loading=\"lazy\"\n            />\n            <div class=\"card-content\">\n                <h2 class=\"card-title\">${title}</h2>\n                <p class=\"card-info\">\n                    <span class=\"card-genre\">${genres}</span>\n                    | <span class=\"card-year\">${year}</span>\n                </p>\n                <ul class=\"card-rating\">\n                    ${createStarRating(rating)}\n                </ul>\n            </div>\n        </section>\n        `;\n    listEl.appendChild(li);\n  });\n\n  // 4. Load More Butonunu YÃ¶net\n  // Toplam filtrelenmiÅŸ film sayÄ±sÄ±, ÅŸu ana kadar gÃ¶sterilen film sayÄ±sÄ±ndan fazlaysa butonu gÃ¶ster\n  if (allFilteredMovies.length > endIndex) {\n    loadMoreBtn.style.display = 'block';\n  } else {\n    loadMoreBtn.style.display = 'none';\n  }\n}\n\nfunction createStarRating(vote_average, isHero = false) {\n  const rating = vote_average / 2;\n  const full = Math.floor(rating);\n  const hasHalf = rating - full >= 0.5;\n  const empty = 5 - full - (hasHalf ? 1 : 0);\n\n  let html = '';\n\n  for (let i = 0; i < full; i++) {\n    html += `<li><svg class=\"star-svg\"><use href=\"./img/sprite.svg#full-star\"></use></svg></li>`;\n  }\n  if (hasHalf) {\n    html += `<li><svg class=\"star-svg\"><use href=\"./img/sprite.svg#half-star\"></use></svg></li>`;\n  }\n  for (let i = 0; i < empty; i++) {\n    html += `<li><svg class=\"star-svg\"><use href=\"./img/sprite.svg#empty-star\"></use></svg></li>`;\n  }\n\n  return html;\n}\n\n// Kart tÄ±klama - MODAL AÃ‡ILMASI Ä°Ã‡Ä°N\ndocument.addEventListener('click', e => {\n  const card = e.target.closest('.library-movie-item');\n  if (card?.dataset.movieId) {\n    openMovieModal(card.dataset.movieId);\n  }\n});\n\n//LOAD MORE BUTONU\nloadMoreBtn.addEventListener('click', () => {\n  currentLibraryPage += 1; // Sayfa numarasÄ±nÄ± artÄ±r\n  loadLibrary(false); // Listeyi temizlemeden yÃ¼kle\n});\n"],"names":["genreMap","API_KEY","selectedGenre","MOVIES_PER_PAGE","currentLibraryPage","allFilteredMovies","selectBox","selected","optionsContainer","listEl","loadMoreBtn","isOpen","e","loadGenres","cachedGenresJson","response","newGenreMap","g","err","getGenresFromLibrary","libraryJson","libraryMovies","uniqueGenreIds","movie","genreIds","id","renderLibraryGenreDropdown","requiredGenreIds","defaultOption","genreName","option","updateDropdownListeners","optionsList","o","loadLibrary","resetList","library","filteredLibrary","movieGenreIds","startIndex","endIndex","moviesToRender","title","poster","rating","year","genres","li","createStarRating","vote_average","isHero","full","hasHalf","empty","html","card","openMovieModal"],"mappings":"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"}