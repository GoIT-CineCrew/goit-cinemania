{"version":3,"file":"myLibrary-Br_nx-Bc.js","sources":["../../src/myLibrary.js"],"sourcesContent":["import { openMovieModal } from './js/modal.js';\n\nconst genreMap = {};\nconst API_KEY = 'aaf24ac7ab7c5211361a71263e777bb9';\n\n// Dropdown\nconst selectBox = document.querySelector('.library-dropdown-filter');\nconst selected = selectBox.querySelector('.selected');\nconst optionsContainer = selectBox.querySelector('.options');\nconst optionsList = selectBox.querySelectorAll('.option');\n\nlet selectedGenre = null; // TMDb genre ID burada tutulacak\n\n// Dropdown aç/kapa\nselected.addEventListener('click', () => {\n  selectBox.classList.toggle('open');\n  optionsContainer.style.display = selectBox.classList.contains('open')\n    ? 'block'\n    : 'none';\n});\n\ndocument\n  .querySelectorAll('.library-dropdown-filter .option')\n  .forEach(option => {\n    option.addEventListener('click', () => {\n      selected.childNodes[0].textContent = option.textContent;\n      const map = {\n        romance: 10749,\n        detective: 9648,\n        thriller: 53,\n        action: 28,\n        documentary: 99,\n        horror: 27,\n      };\n      selectedGenre = map[option.dataset.value] || null;\n      selectBox.classList.remove('open');\n      optionsContainer.style.display = 'none';\n      loadLibrary();\n    });\n  });\n\n// Sayfa dışına tıklayınca dropdown kapanır\ndocument.addEventListener('click', e => {\n  if (!selectBox.contains(e.target)) {\n    selectBox.classList.remove('open');\n    optionsContainer.style.display = 'none';\n  }\n});\n\n// ======================\n// TMDB GENRE LOAD\n// ======================\nasync function loadGenres() {\n  if (Object.keys(genreMap).length > 0) return;\n\n  try {\n    const response = await axios.get(\n      'https://api.themoviedb.org/3/genre/movie/list',\n      {\n        params: { api_key: API_KEY, language: 'en-US' },\n      }\n    );\n\n    response.data.genres.forEach(g => {\n      genreMap[g.id] = g.name;\n    });\n  } catch (err) {\n    console.error('Türler yüklenemedi:', err);\n  }\n}\n\n// Yıldızlar\nfunction createStarRating(rating) {\n  const score = (rating || 0) / 2;\n  const full = Math.floor(score);\n  const half = score - full >= 0.5 ? 1 : 0;\n  const empty = 5 - full - half;\n  let html = '';\n  for (let i = 0; i < full; i++)\n    html += `<li><svg width=\"14\" height=\"14\"><use href=\"./img/sprite.svg#full-star\"></use></svg></li>`;\n  if (half)\n    html += `<li><svg width=\"14\" height=\"14\"><use href=\"./img/sprite.svg#half-star\"></use></svg></li>`;\n  for (let i = 0; i < empty; i++)\n    html += `<li><svg width=\"14\" height=\"14\"><use href=\"./img/sprite.svg#empty-star\"></use></svg></li>`;\n  return html;\n}\n\n// Dropdown seçenek seçildiğinde\noptionsList.forEach(option => {\n  option.addEventListener('click', () => {\n    selected.childNodes[0].textContent = option.textContent;\n\n    optionsList.forEach(o => o.classList.remove('selected'));\n    option.classList.add('selected');\n\n    selectBox.classList.remove('open');\n    optionsContainer.style.display = 'none';\n\n    const value = option.dataset.value;\n\n    // dropdown değerlerine ID eşleme\n    const genreIdMap = {\n      romance: 10749,\n      detective: 9648,\n      thriller: 53,\n      action: 28,\n      documentary: 99,\n      horror: 27,\n    };\n\n    selectedGenre = genreIdMap[value] ?? null;\n\n    loadLibrary(); // filmi filtrele\n  });\n});\n\n// ======================\n// MOVIE RENDER\n// ======================\nasync function loadLibrary() {\n  await loadGenres();\n  let library = JSON.parse(localStorage.getItem('myMovieLibrary')) || '[]';\n  const listEl = document.querySelector('.library-movie-items');\n\n  if (library.length === 0) {\n    document.querySelector('.library-content').style.display = 'none';\n    document.querySelector('.library-content-empty').style.display = 'block';\n    return;\n  }\n\n  document.querySelector('.library-content').style.display = 'block';\n  document.querySelector('.library-content-empty').style.display = 'none';\n\n  listEl.innerHTML = '';\n\n  library.forEach(movie => {\n    // --- GENRE FİLTRESİ ---\n    let movieGenreIds = [];\n    const title = movie.title || 'Unknown';\n    const poster = movie.poster_path\n      ? `https://image.tmdb.org/t/p/w300${movie.poster_path}`\n      : './img/placeholder.jpg';\n    const rating = movie.vote_average ?? 'N/A';\n\n    // 1) genre_ids varsa direkt al\n    if (movie.genre_ids) movieGenreIds = movie.genre_ids;\n    // 2) genres (objeler) varsa ID'leri çek\n    else if (movie.genres) movieGenreIds = movie.genres.map(g => g.id);\n    // 3) genre_names varsa genreMap üzerinden ID’ye çevir\n    else if (movie.genre_names) {\n      movieGenreIds = movie.genre_names\n        .map(name => {\n          const match = Object.entries(genreMap).find(([id, n]) => n === name);\n          return match ? Number(match[0]) : null;\n        })\n        .filter(Boolean);\n    }\n\n    // Filtreleme\n    if (selectedGenre && !movieGenreIds.includes(selectedGenre)) return;\n    \n    // --- Genre isimleri ---\n    let genres = 'Unknown';\n    if (movie.genres?.length) {\n      genres = movie.genres.map(g => g.name).join(', ');\n    } else if (movie.genre_names?.length) {\n      genres = movie.genre_names.join(', ');\n    } else if (movie.genre_ids?.length) {\n      genres = movie.genre_ids\n        .map(id => genreMap[id])\n        .filter(Boolean)\n        .join(', ');\n    }\n\n    const li = document.createElement('li');\n    li.classList.add('library-movie-item');\n    li.dataset.movieId = movie.id;\n    li.style.cursor = 'pointer';\n\n    li.innerHTML = `\n      <section class=\"card\">\n        <img\n          class=\"card-image\"\n          src=\"${poster}\"\n          alt=\"${title}\"\n          loading=\"lazy\"\n        />\n        <div class=\"card-content\">\n          <h2 class=\"card-title\">${title}</h2>\n          <p class=\"card-info\">\n            <span class=\"card-genre\">${genres}</span>\n          </p>\n          <ul class=\"card-rating\">\n            ${createStarRating(rating)}\n          </ul>\n        </div>\n      </section>\n    `;\n\n    listEl.appendChild(li);\n  });\n}\n\n// Kart tıklama\ndocument.addEventListener('click', e => {\n  const card = e.target.closest('.library-movie-item');\n  if (card && card.dataset.movieId) {\n    openMovieModal(card.dataset.movieId);\n  }\n});\n\n// ======================\n// LOAD LIBRARY FROM LOCALSTORAGE\n// ======================\nloadLibrary();\n"],"names":["genreMap","API_KEY","selectBox","selected","optionsContainer","optionsList","selectedGenre","option","loadLibrary","e","loadGenres","g","err","createStarRating","rating","score","full","half","empty","html","i","o","value","library","listEl","movie","movieGenreIds","title","poster","name","match","id","n","genres","_a","_b","_c","li","card","openMovieModal"],"mappings":"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"}