import{c as E,o as M}from"./header-DB9nP7BN.js";const{TMDB_API_KEY:_,TMDB_BASE_URL:w}=E;async function G(){const r=document.querySelector(".library-hero-bg");if(!r){console.log("library-hero-bg bulunamadı");return}try{const e=localStorage.getItem("myMovieLibrary");if(!e){console.log("Kütüphane yok – fallback kullanılıyor");return}const s=JSON.parse(e);if(!Array.isArray(s)||s.length===0){console.log("Kütüphane boş – fallback kullanılıyor");return}const n=s[Math.floor(Math.random()*s.length)],o=typeof n=="number"?n:n.id;if(!o){console.log("Geçerli ID yok");return}console.log("Kütüphaneden seçilen film ID:",o);const t=await fetch(`${w}/movie/${o}?api_key=${_}`);if(!t.ok){console.log("API hatası:",t.status);return}const a=await t.json(),l=a==null?void 0:a.backdrop_path;if(l){const y=`https://image.tmdb.org/t/p/w1920${l}`;r.style.backgroundImage=`url('${y}')`,r.style.backgroundSize="cover",r.style.backgroundPosition="center",r.style.backgroundRepeat="no-repeat",console.log("Library hero yüklendi:",a.title)}else console.log("Backdrop yok:",a.title)}catch(e){console.error("Library hero görseli yüklenemedi:",e)}}G();const u={},O="aaf24ac7ab7c5211361a71263e777bb9";let L=null;const k=20;let p=1,h=[];const d=document.querySelector(".library-dropdown-filter"),S=d.querySelector(".selected"),c=d.querySelector(".options"),b=document.querySelector(".library-movie-items"),i=document.querySelector(".library-load-button");S.addEventListener("click",()=>{const r=d.classList.toggle("open");c.style.display=r?"block":"none"});document.addEventListener("click",r=>{d.contains(r.target)||(d.classList.remove("open"),c.style.display="none")});async function N(){const r=localStorage.getItem("tmdbGenresIdToName");if(r){Object.assign(u,JSON.parse(r));return}try{const e=await axios.get("https://api.themoviedb.org/3/genre/movie/list",{params:{api_key:O,language:"en-US"}}),s={};e.data.genres.forEach(n=>{s[n.id]=n.name}),Object.assign(u,s),localStorage.setItem("tmdbGenresIdToName",JSON.stringify(s))}catch(e){console.error("Türler yüklenemedi:",e)}}function $(){const r=localStorage.getItem("myMovieLibrary");if(!r)return[];const e=JSON.parse(r),s=new Set;return e.forEach(n=>{let o=[];Array.isArray(n.genre_ids)?o=n.genre_ids:Array.isArray(n.genres)&&(o=n.genres.map(t=>t.id)),o.forEach(t=>{u[t]&&s.add(t)})}),Array.from(s)}function q(){const r=$();c.innerHTML="";const e=document.createElement("div");e.classList.add("option","selected"),e.textContent="All Film",e.dataset.value="",c.appendChild(e),r.forEach(s=>{const n=u[s];if(n){const o=document.createElement("div");o.classList.add("option"),o.textContent=n,o.dataset.value=s,c.appendChild(o)}}),T()}function T(){const r=document.querySelectorAll(".library-dropdown-filter .option");r.forEach(e=>{e.addEventListener("click",()=>{S.childNodes[0].textContent=e.textContent,r.forEach(n=>n.classList.remove("selected")),e.classList.add("selected"),d.classList.remove("open"),c.style.display="none",L=e.dataset.value?Number(e.dataset.value):null,p=1,v(!0)})})}document.addEventListener("DOMContentLoaded",async()=>{await N(),q(),v(!0)});function v(r=!1){let e=JSON.parse(localStorage.getItem("myMovieLibrary"))||[];if(e.length===0){document.querySelector(".library-content").style.display="none",document.querySelector(".library-content-empty").style.display="block",i.style.display="none";return}if(r){p=1;let t=e;L&&(t=e.filter(a=>{let l=[];return Array.isArray(a.genre_ids)?l=a.genre_ids:Array.isArray(a.genres)&&(l=a.genres.map(y=>y.id)),l.includes(L)})),h=t,b.innerHTML="",i.style.display="none"}const s=(p-1)*k,n=s+k,o=h.slice(s,n);if(o.length===0&&r){b.innerHTML="<p class='no-results'>Seçilen türe ait film bulunmamaktadır.</p>",i.style.display="none";return}o.forEach(t=>{const a=t.title||"Unknown",l=t.poster_path?`https://image.tmdb.org/t/p/w300${t.poster_path}`:"./img/placeholder.jpg",y=t.vote_average??"N/A",I=t.release_date?t.release_date.slice(0,4):"N/A";let f=[];Array.isArray(t.genre_ids)?f=t.genre_ids:Array.isArray(t.genres)&&(f=t.genres.map(m=>m.id));const A=f.map(m=>u[m]).filter(Boolean).join(", "),g=document.createElement("li");g.classList.add("library-movie-item"),g.dataset.movieId=t.id,g.style.cursor="pointer",g.innerHTML=`
        <section class="card">
            <img
                class="card-image"
                src="${l}"
                alt="${a}"
                loading="lazy"
            />
            <div class="card-content">
                <h2 class="card-title">${a}</h2>
                <p class="card-info">
                    <span class="card-genre">${A}</span>
                    | <span class="card-year">${I}</span>
                </p>
                <ul class="card-rating">
                    ${C(y)}
                </ul>
            </div>
        </section>
        `,b.appendChild(g)}),h.length>n?i.style.display="block":i.style.display="none"}function C(r){const e=r/2,s=Math.floor(e),n=e%1>=.5?1:0,o=5-s-n;let t="";for(let a=0;a<s;a++)t+='<li><svg width="14" height="14"><use href="./img/sprite.svg#full-star"></use></svg></li>';n&&(t+='<li><svg width="14" height="14"><use href="./img/sprite.svg#half-star"></use></svg></li>');for(let a=0;a<o;a++)t+='<li><svg width="14" height="14"><use href="./img/sprite.svg#empty-star"></use></svg></li>';return t}document.addEventListener("click",r=>{const e=r.target.closest(".library-movie-item");e!=null&&e.dataset.movieId&&M(e.dataset.movieId)});i.addEventListener("click",()=>{p+=1,v(!1)});
//# sourceMappingURL=myLibrary-CZHUCAA9.js.map
